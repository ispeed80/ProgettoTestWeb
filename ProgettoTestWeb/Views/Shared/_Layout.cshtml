<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Gestione Esami</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-3">
        <div class="container-fluid">
            <a class="navbar-brand" href="@Url.Action("Index", "Home")">
                <strong>Gestione Esami</strong>
            </a>

            <div class="navbar-nav ms-auto">
                <a class="nav-link @(ViewContext.RouteData.Values["Controller"].ToString() == "Home" ? "active" : "")"
                   href="@Url.Action("Index", "Home")">
                    Principale
                </a>
                <a class="nav-link @(ViewContext.RouteData.Values["Controller"].ToString() == "Admin" ? "active" : "")"
                   href="@Url.Action("Index", "Admin")">
                    Amministrazione
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main role="main">
        @RenderBody()
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay"></div>
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Caricamento...</span>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-3">
        <div class="container-fluid text-center">
            <span class="text-muted">
                © 2025 Sistema Gestione Esami - Versione Web convertita da WinForms
            </span>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS globale -->
    <script>
        window.AppUtils = {
            mostraLoading: function() {
                $('#loadingOverlay, #loadingSpinner').show();
            },

            nascondiLoading: function() {
                $('#loadingOverlay, #loadingSpinner').hide();
            },

            setupGlobalAjaxHandlers: function() {
                $(document).ajaxStart(function() {
                    window.AppUtils.mostraLoading();
                });

                $(document).ajaxStop(function() {
                    window.AppUtils.nascondiLoading();
                });

                $(document).ajaxError(function(event, xhr) {
                    window.AppUtils.nascondiLoading();
                    console.error('Errore AJAX:', xhr.responseText);

                    if (xhr.status === 404) {
                        alert('Risorsa non trovata (404)');
                    } else if (xhr.status === 500) {
                        alert('Errore interno del server (500)');
                    } else if (xhr.status === 0) {
                        alert('Errore di connessione. Verificare la connessione di rete.');
                    }
                });
            }
        };

        $(document).ready(function() {
            window.AppUtils.setupGlobalAjaxHandlers();

            // Tooltip Bootstrap
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
